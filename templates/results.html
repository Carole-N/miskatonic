<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet" />
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <title>Quiz Results</title>
</head>

<body>
    <nav>
        <p>Welcome, {{ user }} | <a href="{{ url_for('home') }}">Home</a> | <a href="{{ url_for('logout') }}">Logout</a>
        </p>
    </nav>

    <div class="results_box">
        <h2 id="quizfinishcenter">Quiz Finished!</h2>
        <h1>Your score: {{ score }} / {{ quizz.questions|length }}</h1>

        <h3 id="quizfinishcenter">Details per question:</h3>
        {% for q in quizz['questions'] %}
        <div class="question-result">
            <p><strong>Question {{ loop.index }}:</strong> {{ q['question_text'] }}</p>

            {% set qkey = q.get('question_id') %}
            {% set user_ans = answers.get(qkey) or [] %}
            {% set correct_ans = q.get('good_answers_texte', []) %}

            {# Vérifie si toutes les réponses de l'utilisateur sont dans les bonnes réponses ET inversement #}
            {% set is_correct = (user_ans|sort == correct_ans|sort) %}

            <p>
                <strong>Your answer(s):</strong>
                {% if user_ans %}
                {{ user_ans | join(', ') }}
                {% if is_correct %}
                <span style="color: green; font-size: 1.2em;">✅</span>
                {% else %}
                <span style="color: red; font-size: 1.2em;">❌</span>
                {% endif %}
                {% else %}
                None <span style="color: red; font-size: 1.2em;">❌</span>
                {% endif %}
            </p>

            <p><strong>Correct answer(s):</strong> {{ correct_ans | join(', ') }}</p>

            {% if q.get('remark') %}
            <p><em>Remark: {{ q['remark'] }}</em></p>
            {% endif %}
        </div>
        <hr>
        {% endfor %}


        <a href="{{ url_for('student_quizz', quizz_id=quizz['_id']) }}"><button>Try Again</button></a>
        <a href="{{ url_for('student_home') }}"><button>Back to Home</button></a>

    </div>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
<footer>
    <div>
        <a href="{{ url_for('privacy') }}">Privacy Policy</a>
    </div>
</footer>

</html>